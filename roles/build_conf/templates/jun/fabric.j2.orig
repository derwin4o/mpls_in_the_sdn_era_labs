{% macro conf_link_p2p(inventory_hostname, vlan, peer, pref, is_left) -%}
{% set ip = pref|ipaddr(0) if is_left else pref|ipaddr(1) %}

        unit {{ vlan }} {
	    vlan-id {{ vlan }};
	    description {{ inventory_hostname }}-{{ peer }};
	    family inet {
		address {{ ip }}
			}	
		}	
	

{%- endmacro %}

{% macro conf_link(inventory_hostname, vlan, desc,  pref) -%}
{% set ip = pref|ipaddr('host') %}

        unit {{ vlan }} {
            vlan-id {{ vlan }};
            description {{ desc }};
            family inet {
                address {{ ip }}
                        }
                }

{%- endmacro %}

interfaces {
    lo0 {
	unit 0;
	family inet {
	    address {{ lo40 }}/32
		}
	}

    gi-0/0/1 {
         vlan-tagging;
         encapsulation flexible-ethernet-services;
{% for link in scheme %}
	{% if link.linktype == "p2p" %}
		{% if inventory_hostname == link.left_router %}
			{{ conf_link_p2p(link.left_router, link.vlan, link.right_router, link.pref, true) }}
		{% elif inventory_hostname == link.right_router %}
			{{ conf_link_p2p(link.right_router, link.vlan, link.left_router, link.pref, false) }}
		{% else %}
		{% endif %}
	{% else %}
		{% if inventory_hostname == link.router %}
			{{ conf_link(inventory_hostname, link.vlan, link.desc, link.pref) }}
		{% else %}
		{% endif %}
	{% endif %}
{% endfor %}
	}
}
